function s(){return(new Date).getTime()}function d(t){return"undefined"!=typeof Storage&&(value=localStorage.getItem(t))&&(value=JSON.parse(value))?value:void 0}function l(t,i){try{return"undefined"!=typeof Storage&&(localStorage.setItem(t,JSON.stringify(i)),!0)}catch(t){return console.error("設定 storage 失敗！",error),!1}}function c(t,e){return e="string"==typeof e?new RegExp(e,"gi"):e.map(function(t){return new RegExp("^"+t+"$","gi")}),t.map(function(i){return(Array.isArray(e)?e.filter(function(t){return i.t.match(t)}).length:i.t.match(e))||(i.s=i.s.filter(function(t){return Array.isArray(e)?t.h.filter(function(i){return e.filter(function(t){return i.match(t)}).length}).length:!!(t.t.match(e)||t.d.match(e)||t.h.filter(function(i){return Array.isArray(e)?e.filter(function(t){return i.match(t)}).length:i.match(e)}).length)})),i}).filter(function(t){return t.s.length})}function i(t){return $("<a />").attr("href",t.u).append($("<figure />").attr("data-bgurl",t.i).css({"background-image":"url("+t.i+")"})).append($("<b />").text(t.t)).append($("<div />").append($(t.h.map(function(t){return $("<span />").text(t)})).map($.fn.toArray))).append($("<section />").text(t.d)).append($("<time />"))}function u(t){return $("<div />").addClass("list").addClass(10<t.s.length?"min":null).addClass("more").append($("<div />").append($("<span />").text(t.t)).append($("<a />").attr("href",t.u).text("更多…"))).append($(t.s.map(i)).map($.fn.toArray))}!function(t,i,e,a,n,o,r){t.GoogleAnalyticsObject=n,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,o=i.createElement(e),r=i.getElementsByTagName(e)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",r.parentNode.insertBefore(o,r)}(window,document,"script",0,"ga"),ga("create","UA-46121102-6","auto"),ga("send","pageview"),function(t,i,e){var a,n=t.getElementsByTagName(i)[0];t.getElementById(e)||((a=t.createElement(i)).id=e,a.src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v3.2&appId=1033322433418965&autoLogAppEvents=1",n.parentNode.insertBefore(a,n))}(document,"script","facebook-jssdk"),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(p){function e(){var t=function(t){if(!(t=p(t)).data("timeago")){t.data("timeago",{datetime:o.datetime(t)});var i=p.trim(t.text());o.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(0<i.length)||o.isTime(t)&&t.attr("title")||t.attr("title")}return t.data("timeago")}(this),i=o.settings,e=p(this).data("tag");return isNaN(t.datetime)||(0==i.cutoff||n(t.datetime)<i.cutoff)&&(""==e||void 0===e?p(this).text(a(t.datetime)):p(this).data(e,a(t.datetime))),this}function a(t){return o.inWords(n(t))}function n(t){return(new Date).getTime()-t.getTime()}p.timeago=function(t){return a(t instanceof Date?t:"string"==typeof t?p.timeago.parse(t):"number"==typeof t?new Date(t):p.timeago.datetime(t))};var o=p.timeago;p.extend(p.timeago,{settings:{refreshMillis:0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:"現在",suffixAgo:"之前",suffixFromNow:null,seconds:"不到 1 分鐘",minute:"約 1 分鐘",minutes:"%d 分鐘",hour:"約 1 小時",hours:"%d 小時",day:"約 1 天",days:"%d 天",month:"約 1 個月",months:"%d 個月",year:"約 1 年",years:"%d 年",numbers:[],wordSeparator:""}},inWords:function(n){function t(t,i){var e=p.isFunction(t)?t(i,n):t,a=o.numbers&&o.numbers[i]||i;return e.replace(/%d/i,a)}var o=this.settings.strings,i=o.prefixAgo,e=o.suffixAgo;this.settings.allowFuture&&n<0&&(i=o.prefixFromNow,e=o.suffixFromNow);var a=Math.abs(n)/1e3,r=a/60,s=r/60,d=s/24,l=d/365,c=a<45&&t(o.seconds,Math.round(a))||a<90&&t(o.minute,1)||r<45&&t(o.minutes,Math.round(r))||r<90&&t(o.hour,1)||s<24&&t(o.hours,Math.round(s))||s<42&&t(o.day,1)||d<30&&t(o.days,Math.round(d))||d<45&&t(o.month,1)||d<365&&t(o.months,Math.round(d/30))||l<1.5&&t(o.year,1)||t(o.years,Math.round(l)),u=o.wordSeparator||"";return void 0===o.wordSeparator&&(u=" "),p.trim([i,c,e].join(u))},parse:function(t){var i=p.trim(t);return i=(i=(i=(i=(i=i.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2")).replace(/([\+\-]\d\d)$/," $100"),new Date(i)},datetime:function(t){var i=o.isTime(t)?p(t).attr("datetime"):p(t).data("time");return o.parse(i)},isTime:function(t){return"time"===p(t).get(0).tagName.toLowerCase()}});var r={init:function(){var t=p.proxy(e,this);t();var i=o.settings;0<i.refreshMillis&&(this._timeagoInterval=setInterval(t,i.refreshMillis))},update:function(t){var i=o.parse(t);p(this).data("timeago",{datetime:i}),o.settings.localeTitle&&p(this).attr("title",i.toLocaleString()),e.apply(this)},updateFromDOM:function(){p(this).data("timeago",{datetime:o.parse(o.isTime(this)?p(this).attr("datetime"):p(this).attr("title"))}),e.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};p.fn.timeago=function(t,i){var e=t?r[t]:r.init;if(!e)throw new Error("Unknown function name '"+t+"' for timeago");return this.each(function(){e.call(this,i)}),this},document.createElement("abbr"),document.createElement("time")}),$(function(){var t=$("body"),e={$el:$("#header"),key:"ioa.header.ttl",ttl:864e5,set:function(){var t=d(e.key),i=setTimeout(function(){e.$el.addClass("new")},2400);e.$el.find(".oa-avatar").click(function(){e.$el.removeClass("new"),l(e.key,s())}),!t||s()>=t+e.ttl||(e.$el.removeClass("new"),clearTimeout(i))}};e.set(),$("*[pubdate], *[editdate]").each(function(){$(this).attr("data-ago",$.timeago($(this).attr("datetime"))).empty()}),$("*[data-bgurl]").each(function(){$(this).css({"background-image":"url("+$(this).data("bgurl")+")"})}),$("*.cnt").each(function(){$(this).addClass("n"+$(this).find(">*").length)}),$("*[data-bc]").each(function(){$("<label />").addClass("_bc").attr("for",$(this).data("bc")).insertAfter($(this))}),$("#info > a").each(function(){var t=$(this).text(),i=$(this).attr("title");$(this).empty().removeAttr("title").append($("<span />").attr("title",i).text(t))}),$("article.panel > section").each(function(){$(this).find("> p > img").each(function(){var t=$(this).parent(),i=$(this).attr("src"),e=$(this).attr("alt");$("<figure />").attr("data-bgurl",i).css({"background-image":"url("+i+")"}).addClass(e.length?"desc":null).append($(this).clone()).append(e.length?$("<figcaption />").addClass("icon-18").text(e):null).insertBefore(t)}),$(this).find("> iframe").each(function(){var t=$(this).clone(!0);$("<div />").addClass("iframe").append(t).insertBefore($(this)),$(this).remove()}),$(this).addClass("show")}),$("article.panel > section a[href]:not([target])").each(function(){$(this).attr("target","_blank")}),window.oaips={inited:!1,$oaips:null,$conter:null,callPvfunc:null,ni:0,$objs:{},init:function(t,i){return window.oaips.inited?this:("function"==typeof PhotoSwipe&&(window.oaips.inited=!0),window.oaips.inited&&(this.$oaips=$('<div class="oaips"><div class="oaips__bg"></div><div class="oaips__scroll-wrap"><div class="oaips__container"><div class="oaips__item"></div><div class="oaips__item"></div><div class="oaips__item"></div></div><div class="oaips__ui oaips__ui--hidden"><div class="oaips__top-bar"><div class="oaips__counter"></div><button class="oaips__button oaips__button--close" title="關閉 (Esc)"></button><button class="oaips__button oaips__button--share" title="分享"></button><button class="oaips__button oaips__button--link" title="鏈結"></button><button class="oaips__button oaips__button--fs" title="全螢幕切換"></button><button class="oaips__button oaips__button--zoom" title="放大/縮小"></button><div class="oaips__preloader"><div class="oaips__preloader__icn"><div class="oaips__preloader__cut"><div class="oaips__preloader__donut"></div></div></div></div></div><div class="oaips__share-modal oaips__share-modal--hidden oaips__single-tap"><div class="oaips__share-tooltip"></div></div><button class="oaips__button oaips__button--arrow--left" title="上一張"></button><button class="oaips__button oaips__button--arrow--right" title="下一張"></button><div class="oaips__caption"><div class="oaips__caption__center"></div></div></div></div></div>').appendTo(t),this.$conter=this.$oaips.find("div.oaips__caption__center"),i&&"function"==typeof i&&(this.callPvfunc=i)),this)},show:function(t,i,e,a){if(!window.oaips.inited)return this;if(!isNaN(t)&&window.oaips.$oaips&&window.oaips.$conter){var n=i.get(0).$objs.map(function(){var t=$(this).find("img"),i=$(this).find("figcaption");return{w:t.get(0).width,h:t.get(0).height,src:$(this).data("bgurl"),href:$(this).data("bgurl"),title:i.length?i.html():"",content:i.length?i.html():"",el:$(this).get(0)}}).toArray(),o={index:parseInt(t,10)-(a?1:0),galleryUID:i.data("oaips-uid"),showHideOpacity:!0,showAnimationDuration:e?0:500,getThumbBoundsFn:function(t){var i=window.pageYOffset||document.documentElement.scrollTop,e=n[t].el.getBoundingClientRect();return{x:e.left,y:e.top+i,w:e.width}}},r=new PhotoSwipe(window.oaips.$oaips.get(0),PhotoSwipeUI_Default,n,o,i.get(0).$objs.map(function(){return $(this).data("pvid")?$(this).data("pvid"):""}));return r.init(function(t){console.error(t)}),window.oaips.$conter.width(Math.floor(r.currItem.w*r.currItem.fitRatio)-20),r.listen("beforeChange",function(){window.oaips.$conter.removeClass("show"),window.oaips.$conter.width(Math.floor(r.currItem.w*r.currItem.fitRatio-20))}),r.listen("afterChange",function(){window.oaips.$conter.addClass("show")}),r.listen("resize",function(){window.oaips.$conter.width(Math.floor(r.currItem.w*r.currItem.fitRatio-20))}),this}},set:function(t,e){if(!window.oaips.inited)return this;var i=t instanceof jQuery?t:$(t);return!!i.length&&(i.each(function(t){var i=$(this);i.data("oaips-uid",window.oaips.ni+t+1),i.get(0).$objs=i.find(e),i.find(e).click(function(){window.oaips.show(i.get(0).$objs.index($(this)),i)}),window.oaips.$objs[window.oaips.ni+t]=i}),window.oaips.ni=window.oaips.ni+1,this)},listenUrl:function(){if(!window.oaips.inited)return this;var e={};return window.location.hash.replace("#","").split("&").forEach(function(t,i){t&&(t=t.split("=")).length&&t[1].length&&(e[t[0]]=t[1])}),!(!window.oaips.$objs[e.gid-1]||0===Object.keys(e).length||void 0===e.gid||void 0===e.pid)&&(setTimeout(function(){window.oaips.show(e.pid-1,window.oaips.$objs[e.gid-1],!0,!0)},500),this)}},window.oaips.init(t),window.oaips.set("section.md","figure[data-bgurl]"),window.oaips.set("#pics","figure[data-bgurl]");var i=$("#search"),a=new URL(location.href),n=a.pathname.substring(a.pathname.lastIndexOf("/")+1),o=a.searchParams.get("q");if("search.html"===n){if(a=a.href.replace(n,""),!o||!o.length)return window.location.replace(a);o.match(/^tags?:(.*)/)&&(o=o.match(/^tags?:(.*)/)[1].split(",").map(Function.prototype.call,String.prototype.trim)),$("#q").val(decodeURIComponent(Array.isArray(o)?"tags:"+o.join(","):o));var r={key:"ioa.all",api:i.data("api"),ttl:36e5,get:function(i,t){var e=d(r.key);return e&&e.time&&s()<e.time+r.ttl?i&&i(e.content):$.get(r.api,function(t){return l(r.key,{time:s(),content:t}),i&&i(t)}).fail(t)}};r.get(function(t){i.attr("data-title","找不到符合的資料。").append($(c(t,o).map(u)).map($.fn.toArray))},function(){return window.location.replace(a)})}window.oaips.listenUrl()});